<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}SVFinance{% endblock %}</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- App styles -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/variables.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/app.css') }}"
    />

    {% block head %}{% endblock %}
  </head>
  <body class="auth-layout">
    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %}
    <div class="container pt-3">
      {% for category, message in messages %}
      <div
        class="alert alert-{{ category }} alert-dismissible fade show"
        role="alert"
      >
        {{ message }}
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
        ></button>
      </div>
      {% endfor %}
    </div>
    {% endif %} {% endwith %} {% block content %}{% endblock %}

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- C·∫•u h√¨nh to√†n c·ª•c cho frontend -->
    <script>
      window.BASE_API_URL = "{{ BASE_API_URL|default('', true) }}";
      window.APP_CONFIG = {
        apiBase: "{{ BASE_API_URL|default('', true) }}", // "" = same-origin
        googleClientId: "{{ GOOGLE_CLIENT_ID|default('', true) }}", // d√πng cho Google
      };
    </script>

    <!-- Google Identity Services (cho Google Sign-In n·∫øu b·∫°n b·∫≠t) -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <!-- App scripts chung -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>

    {# üîë Quan tr·ªçng: - N·∫øu ALLOW_AUTH_JS == False -> KH√îNG load auth.js - Nghƒ©a
    l√† trang /login (user th∆∞·ªùng) s·∫Ω kh√¥ng auto g·∫Øn attachLogin() v√† s·∫Ω kh√¥ng
    ph√° form POST #} {% if ALLOW_AUTH_JS|default(true, true) %}
    <script src="{{ url_for('static', filename='js/auth.js') }}"></script>
    {% endif %} {% block scripts %}{% endblock %}

    <script>
      (function () {
        const params = new URLSearchParams(window.location.search);
        if (params.get("logout_ok") === "1") {
          const container = document.createElement("div");
          container.innerHTML = `
      <div class="alert alert-success alert-dismissible fade show m-3" role="alert" style="position:fixed;top:1rem;right:1rem;z-index:2000;min-width:240px;">
        ƒêƒÉng xu·∫•t th√†nh c√¥ng!
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>`;
          document.body.appendChild(container);

          params.delete("logout_ok");
          const cleanUrl =
            window.location.pathname +
            (params.toString() ? "?" + params.toString() : "") +
            window.location.hash;
          window.history.replaceState({}, "", cleanUrl);
        }
      })();
    </script>
  </body>
</html>
