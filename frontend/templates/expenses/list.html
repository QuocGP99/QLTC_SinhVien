{% extends "base.html" %} {% block title %}Chi tiêu{% endblock %} {% block head
%}
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
  rel="stylesheet"
/>
<style>
  .page-wrap {
    max-width: 980px;
    margin: 0 auto;
  }
  .kpi-card .value {
    font-weight: 700;
    font-size: 1.2rem;
    color: #6f42c1;
  }
  .expense-card {
    border: 1px solid #edf0f5;
    border-radius: 10px;
    margin-bottom: 0.75rem;
  }
  .expense-card .amount {
    color: #d0333a;
    font-weight: 600;
  }
  .badge-soft {
    background: #f6f7fb;
    border: 1px solid #f8f8f8ff;
    color: #6b7280;
    font-weight: 500;
  }

  /* ====== KPI màu gradient (thêm mới) ====== */
  .kpi-card .card {
    border: none;
    border-radius: 16px;
    color: #fff;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
  }
  .kpi-total {
    background: linear-gradient(135deg, #2563eb, #1d4ed8);
  }
  .kpi-count {
    background: linear-gradient(135deg, #f43f5e, #e11d48);
  }
  .kpi-avg {
    background: linear-gradient(135deg, #22c55e, #16a34a);
  }
  .kpi-card .label {
    font-size: 0.85rem;
    opacity: 0.9;
  }
  .kpi-card .value {
    font-weight: 700;
    font-size: 1.3rem;
    margin-top: 0.25rem;
    color: #fff;
  }
  /* ====== /KPI gradient ====== */

  /* Màu cho danh mục (giữ nguyên) */
  .badge-soft[data-cat="Ăn uống"] {
    background: #eaf2ff;
    color: #2563eb;
  }
  .badge-soft[data-cat="Di chuyển"] {
    background: #e7f9f1;
    color: #16a34a;
  }
  .badge-soft[data-cat="Giải trí"] {
    background: #fde7f7;
    color: #db2777;
  }
  .badge-soft[data-cat="Giáo trình"],
  .badge-soft[data-cat="Học tập"] {
    background: #fff8e5;
    color: #ca8a04;
  }
  .badge-soft[data-cat="Nhà ở"] {
    background: #e8eaf0;
    color: #475569;
  }
  .badge-soft[data-cat="Mua sắm"] {
    background: #fef3c7;
    color: #b45309;
  }
  .badge-soft[data-cat="Sức khỏe"] {
    background: #e0f2fe;
    color: #0284c7;
  }

  .category-legend {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 12px;
    font-size: 0.9rem;
    color: #555;
  }
  .category-legend span {
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }
  .category-color-box {
    display: inline-block;
    width: 20px;
    height: 10px;
    border-radius: 2px;
  }
  .toolbar .btn {
    border-radius: 10px;
  }
  .filter-icon {
    color: #6b7280;
  }
</style>

{% endblock %} {% block content %}
<div class="py-4 page-wrap">
  <!-- Header -->
  <div class="d-flex align-items-center justify-content-between mb-3">
    <div>
      <h4 class="mb-1">Theo dõi chi tiêu</h4>
      <div class="text-muted small">Quản lý và theo dõi chi tiêu hằng ngày</div>
    </div>
    <div class="toolbar">
      <button id="addExpenseBtn" class="btn btn-primary">
        <i class="bi bi-plus-lg me-1"></i> Thêm chi tiêu
      </button>
    </div>
  </div>

  <!-- KPI Cards có màu -->
  <div class="row g-3 kpi-card mb-4 text-white">
    <div class="col-md-4">
      <div class="card kpi-total">
        <div class="card-body">
          <div class="label">Tổng chi tháng này</div>
          <div id="kpiTotal" class="value">0 ₫</div>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card kpi-count">
        <div class="card-body">
          <div class="label">Số giao dịch</div>
          <div id="kpiCount" class="value">0</div>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card kpi-avg">
        <div class="card-body">
          <div class="label">Trung bình mỗi giao dịch</div>
          <div id="kpiAvg" class="value">0 ₫</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Legend danh mục -->
  <div class="category-legend">
    <span
      ><span class="category-color-box" style="background: #2563eb"></span> Ăn
      uống</span
    >
    <span
      ><span class="category-color-box" style="background: #16a34a"></span> Di
      chuyển</span
    >
    <span
      ><span class="category-color-box" style="background: #ca8a04"></span> Học
      tập</span
    >
    <span
      ><span class="category-color-box" style="background: #db2777"></span> Giải
      trí</span
    >
    <span
      ><span class="category-color-box" style="background: #475569"></span> Nhà
      ở</span
    >
  </div>

  <!-- Recent + Filter -->
  <div class="card border-0 shadow-sm">
    <div
      class="card-header bg-white d-flex align-items-center justify-content-between"
    >
      <div class="fw-semibold">Chi tiêu gần đây</div>

      <div class="d-flex align-items-center gap-2">
        <i class="bi bi-funnel filter-icon"></i>
        <div class="dropdown">
          <button
            class="btn btn-light btn-sm dropdown-toggle"
            id="categoryFilterBtn"
            data-bs-toggle="dropdown"
          >
            Tất cả danh mục
          </button>
          <ul
            class="dropdown-menu dropdown-menu-end"
            id="categoryMenu"
            style="min-width: 220px"
          >
            <li>
              <a class="dropdown-item active" data-value="">Tất cả danh mục</a>
            </li>
            <!-- các danh mục sẽ được js thêm vào -->
          </ul>
        </div>
      </div>
    </div>

    <div class="card-body">
      <div id="txList"></div>
    </div>
  </div>
</div>

<!-- Modal Thêm / Sửa -->
<div class="modal fade" id="txModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form class="modal-content" id="txForm">
      <div class="modal-header">
        <h5 class="modal-title" id="txModalTitle">Thêm chi tiêu mới</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label">Mô tả *</label>
          <input
            class="form-control"
            name="desc"
            placeholder="vd: Ăn trưa ở căn tin"
            required
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Số tiền *</label>
          <input
            type="number"
            class="form-control"
            name="amount"
            min="0"
            step="1000"
            value="0"
            required
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Danh mục *</label>
          <select class="form-select" name="category" required></select>
        </div>
        <div class="mb-3">
          <label class="form-label">Ngày</label>
          <input type="date" class="form-control" name="date" required />
        </div>
        <div class="mb-1">
          <label class="form-label">Phương thức</label>
          <select class="form-select" name="method">
            <option>Tiền mặt</option>
            <option>Thẻ</option>
            <option>Ví điện tử</option>
            <option>Khác</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button
          class="btn btn-outline-secondary"
          type="button"
          data-bs-dismiss="modal"
        >
          Hủy
        </button>
        <button class="btn btn-primary" type="submit">Lưu chi tiêu</button>
      </div>
    </form>
  </div>
</div>
{% endblock %} {% block scripts %}
<script src="{{ url_for('static', filename='js/expenses.js') }}"></script>
<script>
  Expenses.init();
</script>
{% endblock %}
