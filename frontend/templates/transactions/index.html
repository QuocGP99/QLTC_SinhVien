{% extends "base.html" %} {% block title %}Quản lý giao dịch{% endblock %} {%
block head %}
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
  rel="stylesheet"
/>
<style>
  .page-wrap {
    max-width: 1100px;
    margin: 0 auto;
  }
  .feature-card {
    border: 1px solid #edf0f5;
    border-radius: 14px;
    transition: 0.2s;
  }
  .feature-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
  }
  .tx-card {
    border: 1px solid #edf0f5;
    border-radius: 10px;
    margin-bottom: 0.5rem;
  }
  .amount-exp {
    color: #dc2626;
    font-weight: 600;
  }
  .amount-inc {
    color: #16a34a;
    font-weight: 600;
  }
  .badge-soft {
    background: #f6f7fb;
    border: 1px solid #f8f8f8ff;
    color: #6b7280;
    font-weight: 500;
  }
  .cal {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 0.5rem;
  }
  .cal .cell {
    border: 1px solid #edf0f5;
    border-radius: 10px;
    min-height: 95px;
    padding: 0.5rem;
    background: #fff;
  }
  .cal .cell .d {
    font-size: 0.9rem;
    color: #6b7280;
  }
  .cal .cell .sum {
    margin-top: 0.35rem;
    font-size: 0.9rem;
  }
  .cal .cell .exp {
    color: #dc2626;
  }
  .cal .cell .inc {
    color: #16a34a;
  }
  .cal .cell .net.pos {
    color: #16a34a;
  }
  .cal .cell .net.neg {
    color: #dc2626;
  }
  .cal .dow {
    font-weight: 600;
    color: #64748b;
    padding: 0.25rem 0.5rem;
  }
  .filter-wrap .form-select,
  .filter-wrap .form-control {
    min-width: 180px;
  }
</style>
{% endblock %} {% block content %}
<div class="py-4 page-wrap">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <div>
      <h4 class="mb-1">Quản lý giao dịch</h4>
      <div class="text-muted small">
        Lịch sử giao dịch (thu & chi) + Lịch trực quan
      </div>
    </div>
    <div class="d-flex gap-2">
      <a
        href="{{ url_for('web.page_expenses') }}"
        class="btn btn-outline-danger"
      >
        <i class="bi bi-cash-stack me-1"></i> Chi tiêu
      </a>
      <a
        href="{{ url_for('web.page_incomes') }}"
        class="btn btn-outline-success"
      >
        <i class="bi bi-wallet2 me-1"></i> Thu nhập
      </a>
    </div>
  </div>

  <!-- Bộ lọc -->
  <div class="card border-0 shadow-sm mb-3">
    <div class="card-body filter-wrap d-flex flex-wrap align-items-end gap-3">
      <div>
        <label class="form-label mb-1">Tháng</label>
        <input type="month" id="filterMonth" class="form-control" />
      </div>
      <div>
        <label class="form-label mb-1">Loại</label>
        <select id="filterType" class="form-select">
          <option value="">Tất cả</option>
          <option value="expense">Chỉ Chi tiêu</option>
          <option value="income">Chỉ Thu nhập</option>
        </select>
      </div>
      <div>
        <label class="form-label mb-1">Danh mục Thu nhập</label>
        <select id="filterIncomeCat" class="form-select">
          <option value="">Tất cả</option>
        </select>
      </div>
      <div class="ms-auto">
        <button id="btnReset" class="btn btn-light">Đặt lại</button>
      </div>
    </div>
  </div>

  <!-- Lịch trực quan -->
  <div class="card border-0 shadow-sm mb-3">
    <div
      class="card-header bg-white d-flex align-items-center justify-content-between"
    >
      <div class="fw-semibold">Lịch giao dịch theo ngày</div>
      <div class="text-muted small" id="calMonthLabel"></div>
    </div>
    <div class="card-body">
      <div
        class="d-grid"
        style="
          grid-template-columns: repeat(7, 1fr);
          gap: 0.5rem;
          margin-bottom: 0.5rem;
        "
      >
        <div class="dow text-center">T2</div>
        <div class="dow text-center">T3</div>
        <div class="dow text-center">T4</div>
        <div class="dow text-center">T5</div>
        <div class="dow text-center">T6</div>
        <div class="dow text-center">T7</div>
        <div class="dow text-center">CN</div>
      </div>
      <div id="calendar" class="cal"></div>
    </div>
  </div>

  <!-- Danh sách giao dịch gần đây -->
  <div class="card border-0 shadow-sm">
    <div
      class="card-header bg-white d-flex align-items-center justify-content-between"
    >
      <div class="fw-semibold" id="recentSection">Giao dịch gần đây</div>
      <div class="text-muted small">Kết hợp Thu nhập & Chi tiêu</div>
    </div>
    <div class="card-body">
      <div id="txList"></div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  window.BASE_API_URL = "{{ BASE_API_URL or '' }}";
</script>
<script src="{{ url_for('static', filename='js/transactions_home.js') }}"></script>
<script>
  TransactionsHome.init();
</script>
{% endblock %}
