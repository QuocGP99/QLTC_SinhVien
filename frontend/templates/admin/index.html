{% extends 'base_admin.html' %} {% block title %}Admin Dashboard{% endblock %}
{% block head %}
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
/>
<style>
  .admin-toolbar {
    gap: 0.5rem;
  }
</style>
{% endblock %} {% block content %}
<div class="container py-4">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h1 class="h4 mb-0">Admin Dashboard</h1>
    <div class="admin-toolbar d-flex">
      <a href="/admin/users" class="btn btn-outline-primary btn-sm">
        <i class="bi bi-people me-1"></i> Quản lý người dùng
      </a>
      <button class="btn btn-outline-danger btn-sm" id="btnLogout">
        <i class="bi bi-box-arrow-right me-1"></i> Đăng xuất
      </button>
    </div>
  </div>

  <div class="alert alert-info">
    Bạn đang đăng nhập với quyền <strong>admin</strong>.
  </div>

  <!-- TODO: nội dung quản trị thêm ở đây (thống kê, logs, cài đặt, ...) -->
  <div class="row g-3">
    <div class="col-lg-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <div class="small text-muted">Người dùng hoạt động</div>
              <div class="fs-4 fw-semibold" id="metricActiveUsers">--</div>
            </div>
            <i class="bi bi-graph-up fs-2 text-primary"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <div class="small text-muted">Tổng người dùng</div>
              <div class="fs-4 fw-semibold" id="metricTotalUsers">--</div>
            </div>
            <i class="bi bi-people fs-2 text-secondary"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <div class="small text-muted">Báo cáo gần đây</div>
              <div class="fs-4 fw-semibold" id="metricRecentReports">--</div>
            </div>
            <i class="bi bi-clipboard-data fs-2 text-success"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  // ===== Guard cho ADMIN: phải có token + role=admin (base_admin.html cũng có guard sớm) =====
  (function () {
    try {
      const u = JSON.parse(localStorage.getItem("user") || "null");
      const t = localStorage.getItem("access_token");
      if (!u || !t) {
        location.replace("/admin");
        return;
      }
      if (u.role !== "admin") {
        alert("Bạn không có quyền truy cập trang admin.");
        location.replace("/login");
      }
    } catch (e) {
      console.warn("Admin guard error:", e);
      location.replace("/admin");
    }
  })();

  // ===== Đăng xuất =====
  document.getElementById("btnLogout")?.addEventListener("click", () => {
    try {
      localStorage.removeItem("access_token");
      localStorage.removeItem("refresh_token");
      localStorage.removeItem("token_type");
      localStorage.removeItem("user");
    } catch (_) {}
    location.href = "/admin";
  });

  // ===== (Tuỳ chọn) Gọi API admin để lấy số liệu nhanh =====
  // Ví dụ giả lập số liệu; khi có API thật, thay bằng fetch tới /api/admin/metrics
  (function mockMetrics() {
    document.getElementById("metricActiveUsers").textContent = "24";
    document.getElementById("metricTotalUsers").textContent = "138";
    document.getElementById("metricRecentReports").textContent = "5";
  })();
</script>
{% endblock %}
