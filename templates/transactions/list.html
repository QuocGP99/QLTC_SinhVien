{% extends 'base.html' %}
{% block head %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
{% endblock %}

{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <div>
    <h1 class="h4 fw-bold mb-1">Quản lý chi tiêu</h1>
    <div class="text-muted">Theo dõi và quản lý các khoản chi hằng ngày</div>
  </div>
  <!-- Nút thêm chi tiêu -->
  <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#txModal">
    <i class="bi bi-plus-lg me-1"></i> Thêm chi tiêu
  </button>
</div>

<!-- KPI -->
<div class="row g-3 mb-4">
  <div class="col-md-4">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="text-muted mb-1">Tổng chi tháng này</div>
        <div class="fs-4 fw-semibold text-danger" id="kpiTotal">₫0</div>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="text-muted mb-1">Số giao dịch</div>
        <div class="fs-4 fw-semibold" id="kpiCount">0</div>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="text-muted mb-1">Trung bình / giao dịch</div>
        <div class="fs-4 fw-semibold text-primary" id="kpiAvg">₫0</div>
      </div>
    </div>
  </div>
</div>

<!-- Danh sách -->
<div class="card shadow-sm">
  <div class="card-body">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <div class="fw-semibold">Chi tiêu gần đây</div>
      <div class="dropdown">
        <button class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" id="categoryFilterBtn">
          Tất cả danh mục
        </button>
        <ul class="dropdown-menu" id="categoryMenu">
          <li><a class="dropdown-item active" data-value="">Tất cả danh mục</a></li>
        </ul>
      </div>
    </div>
    <div id="txList" class="vstack gap-3"></div>
  </div>
</div>

<!-- Modal thêm giao dịch -->
{% include 'transactions/form.html' %}
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/expenses.js') }}"></script>
<script>
  document.addEventListener('DOMContentLoaded', ()=>{
    Expenses.init({ seedUrl: '/static/data/seed.json' });
  });
</script>
{% endblock %}
